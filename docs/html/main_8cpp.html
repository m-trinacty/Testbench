<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ODrive library: main.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ODrive library
   </div>
   <div id="projectbrief">Library for controlling ODrive unit and motors written in C++ and store data from it</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">main.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;iostream&gt;</code><br />
<code>#include &lt;string&gt;</code><br />
<code>#include &lt;memory&gt;</code><br />
<code>#include &lt;chrono&gt;</code><br />
<code>#include &lt;errno.h&gt;</code><br />
<code>#include &lt;syslog.h&gt;</code><br />
<code>#include &lt;signal.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;mutex&gt;</code><br />
<code>#include &lt;filesystem&gt;</code><br />
<code>#include &lt;sstream&gt;</code><br />
<code>#include &lt;iomanip&gt;</code><br />
<code>#include &lt;thread&gt;</code><br />
<code>#include &lt;fstream&gt;</code><br />
<code>#include &lt;queue&gt;</code><br />
<code>#include &lt;vector&gt;</code><br />
<code>#include &lt;sys/stat.h&gt;</code><br />
<code>#include &quot;<a class="el" href="oDrive_8h_source.html">oDrive.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="logger_8h_source.html">logger.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="helper_8h_source.html">helper.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="server_8h_source.html">server.h</a>&quot;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for main.cpp:</div>
<div class="dyncontent">
<div class="center"><img src="main_8cpp__incl.png" border="0" usemap="#amain_8cpp" alt=""/></div>
<map name="amain_8cpp" id="amain_8cpp">
<area shape="rect" title=" " alt="" coords="892,5,974,32"/>
<area shape="rect" title=" " alt="" coords="10,229,90,256"/>
<area shape="rect" title=" " alt="" coords="240,229,298,256"/>
<area shape="rect" title=" " alt="" coords="749,80,826,107"/>
<area shape="rect" title=" " alt="" coords="306,155,373,181"/>
<area shape="rect" title=" " alt="" coords="851,80,919,107"/>
<area shape="rect" title=" " alt="" coords="943,80,1019,107"/>
<area shape="rect" title=" " alt="" coords="1043,80,1116,107"/>
<area shape="rect" title=" " alt="" coords="1140,80,1211,107"/>
<area shape="rect" title=" " alt="" coords="1236,80,1300,107"/>
<area shape="rect" title=" " alt="" coords="1324,80,1414,107"/>
<area shape="rect" title=" " alt="" coords="1438,80,1513,107"/>
<area shape="rect" title=" " alt="" coords="1537,80,1612,107"/>
<area shape="rect" title=" " alt="" coords="1636,80,1700,107"/>
<area shape="rect" title=" " alt="" coords="603,155,676,181"/>
<area shape="rect" title=" " alt="" coords="1724,80,1787,107"/>
<area shape="rect" title=" " alt="" coords="851,155,914,181"/>
<area shape="rect" title=" " alt="" coords="1812,80,1897,107"/>
<area shape="rect" href="oDrive_8h.html" title=" " alt="" coords="154,80,232,107"/>
<area shape="rect" href="logger_8h.html" title=" " alt="" coords="450,80,525,107"/>
<area shape="rect" href="helper_8h.html" title=" " alt="" coords="600,80,674,107"/>
<area shape="rect" href="server_8h.html" title=" " alt="" coords="21,155,96,181"/>
<area shape="rect" title=" " alt="" coords="1921,80,1996,107"/>
<area shape="rect" href="port_8h.html" title=" " alt="" coords="120,155,180,181"/>
<area shape="rect" title=" " alt="" coords="115,229,199,256"/>
<area shape="rect" title=" " alt="" coords="448,155,578,181"/>
<area shape="rect" title=" " alt="" coords="752,155,826,181"/>
</map>
</div>
</div>
<p><a href="main_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ae19b6bb2940d2fbe0a79852b070eeafd"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#ae19b6bb2940d2fbe0a79852b070eeafd">STOP</a>&#160;&#160;&#160;1</td></tr>
<tr class="separator:ae19b6bb2940d2fbe0a79852b070eeafd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a3b33e6f48f5d988f336e915c5346eb95"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#a3b33e6f48f5d988f336e915c5346eb95">intHandler</a> (int dummy)</td></tr>
<tr class="memdesc:a3b33e6f48f5d988f336e915c5346eb95"><td class="mdescLeft">&#160;</td><td class="mdescRight">intHandler  <a href="main_8cpp.html#a3b33e6f48f5d988f336e915c5346eb95">More...</a><br /></td></tr>
<tr class="separator:a3b33e6f48f5d988f336e915c5346eb95"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adf98873ad83fffa5da0b4773a669d4ad"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#adf98873ad83fffa5da0b4773a669d4ad">spin</a> (float vel, int time)</td></tr>
<tr class="memdesc:adf98873ad83fffa5da0b4773a669d4ad"><td class="mdescLeft">&#160;</td><td class="mdescRight">spin  <a href="main_8cpp.html#adf98873ad83fffa5da0b4773a669d4ad">More...</a><br /></td></tr>
<tr class="separator:adf98873ad83fffa5da0b4773a669d4ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae66f6b31b5ad750f1fe042a706a4e3d4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a> ()</td></tr>
<tr class="memdesc:ae66f6b31b5ad750f1fe042a706a4e3d4"><td class="mdescLeft">&#160;</td><td class="mdescRight">main  <a href="main_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">More...</a><br /></td></tr>
<tr class="separator:ae66f6b31b5ad750f1fe042a706a4e3d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a2705b3e3588486b097f1cdd1ac8a4915"><td class="memItemLeft" align="right" valign="top">std::shared_ptr&lt; <a class="el" href="classserver.html">server</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#a2705b3e3588486b097f1cdd1ac8a4915">server_port</a></td></tr>
<tr class="separator:a2705b3e3588486b097f1cdd1ac8a4915"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae22136461a8511c472f1f662bd8f8fc3"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#ae22136461a8511c472f1f662bd8f8fc3">logFilePath</a> =&quot;/var/log/tevogs/&quot;</td></tr>
<tr class="separator:ae22136461a8511c472f1f662bd8f8fc3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a99867921a079d50ae18d40a21e6bcf73"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#a99867921a079d50ae18d40a21e6bcf73">logFileName</a> = &quot;/var/log/tevogs/testbench.log&quot;</td></tr>
<tr class="separator:a99867921a079d50ae18d40a21e6bcf73"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a436ee5100c9f7c541dc8648cf2afec59"><td class="memItemLeft" align="right" valign="top">std::ofstream&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#a436ee5100c9f7c541dc8648cf2afec59">logFile</a></td></tr>
<tr class="separator:a436ee5100c9f7c541dc8648cf2afec59"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa73e018b04368e7afaded77ef0ac69db"><td class="memItemLeft" align="right" valign="top">std::mutex&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#aa73e018b04368e7afaded77ef0ac69db">m</a></td></tr>
<tr class="separator:aa73e018b04368e7afaded77ef0ac69db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1c22f45bce9e423288fca0956719ce94"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#a1c22f45bce9e423288fca0956719ce94">semaphor</a></td></tr>
<tr class="separator:a1c22f45bce9e423288fca0956719ce94"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ae19b6bb2940d2fbe0a79852b070eeafd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae19b6bb2940d2fbe0a79852b070eeafd">&#9670;&nbsp;</a></span>STOP</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STOP&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="main_8cpp_source.html#l00034">34</a> of file <a class="el" href="main_8cpp_source.html">main.cpp</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a3b33e6f48f5d988f336e915c5346eb95"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3b33e6f48f5d988f336e915c5346eb95">&#9670;&nbsp;</a></span>intHandler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void intHandler </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dummy</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>intHandler </p>
<p>This function is called when application is manually stopped. </p>

<p class="definition">Definition at line <a class="el" href="main_8cpp_source.html#l00048">48</a> of file <a class="el" href="main_8cpp_source.html">main.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;                           {</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <a class="code" href="main_8cpp.html#a436ee5100c9f7c541dc8648cf2afec59">logFile</a>&lt;&lt;<span class="stringliteral">&quot;Killed&quot;</span>&lt;&lt;std::endl;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <a class="code" href="main_8cpp.html#a2705b3e3588486b097f1cdd1ac8a4915">server_port</a>-&gt;dconn_server();</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;}</div>
<div class="ttc" id="amain_8cpp_html_a2705b3e3588486b097f1cdd1ac8a4915"><div class="ttname"><a href="main_8cpp.html#a2705b3e3588486b097f1cdd1ac8a4915">server_port</a></div><div class="ttdeci">std::shared_ptr&lt; server &gt; server_port</div><div class="ttdef"><b>Definition:</b> <a href="main_8cpp_source.html#l00036">main.cpp:36</a></div></div>
<div class="ttc" id="amain_8cpp_html_a436ee5100c9f7c541dc8648cf2afec59"><div class="ttname"><a href="main_8cpp.html#a436ee5100c9f7c541dc8648cf2afec59">logFile</a></div><div class="ttdeci">std::ofstream logFile</div><div class="ttdef"><b>Definition:</b> <a href="main_8cpp_source.html#l00039">main.cpp:39</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae66f6b31b5ad750f1fe042a706a4e3d4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae66f6b31b5ad750f1fe042a706a4e3d4">&#9670;&nbsp;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>main </p>
<p>Main function tries to create log file for logging position data from ODrive if it does not already exist Then it waits until connection is created and then in infinete loop are read messages from client which can start and stop spinning testbench </p><dl class="section return"><dt>Returns</dt><dd>Main function returns status code </dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">EXIT_SUCCESS</td><td>in case in succesfull executing main function </td></tr>
    <tr><td class="paramname">EXIT_FAILURE</td><td>in case of fail in main function </td></tr>
  </table>
  </dd>
</dl>
<p>Configure syslog</p>
<p>Try to create a file for logging at "/var/log/tevogs/testbench.log"</p>
<p>Check if the file for logging at "/var/log/tevogs/testbench.log" can be opened</p>
<p>Infinite loop which should never be exited</p>
<p>Create listening socket server at defined adress and port</p>
<p>Connect to server</p>
<p>Create second thread for spinning function to run at</p>
<p>Endless loop until connection breaks/client disconnect</p>
<p>In the beging of every loop check for incoming message</p>
<p>START (velocity) (time in sec) is only allowed messag with more words. Here is the message parsed to concrete variables</p>
<p>In case of Start message and testbench is not running, start a thread and start spining</p>
<p>If testbench is already running, do nothing</p>
<p>In case of STOP message, stop testbench, do not disconnect</p>
<p>In case of QUIT message stop testbench and disconnect</p>
<p>In case of discconecting, join the thread so it can be reused</p>

<p class="definition">Definition at line <a class="el" href="main_8cpp_source.html#l00142">142</a> of file <a class="el" href="main_8cpp_source.html">main.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;           {</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <a class="code" href="classhelper.html#a32bf313f928a848166485d6849b60e9a">helper::cfg_syslog</a>();                                                                   </div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="classhelper.html#ad6664f31cf67b68d207479b4f930bd63">helper::check_file</a>(<a class="code" href="main_8cpp.html#a99867921a079d50ae18d40a21e6bcf73">logFileName</a>)){                                                   </div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        syslog(LOG_INFO,<span class="stringliteral">&quot;Creating directory&quot;</span>);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160; </div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="keywordflow">if</span>(mkdir(<a class="code" href="main_8cpp.html#ae22136461a8511c472f1f662bd8f8fc3">logFilePath</a>.c_str(), S_IRWXU | S_IRWXG | S_IROTH | S_IXOTH)&lt;0){</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            syslog(LOG_ERR, <span class="stringliteral">&quot;Can not create folder for log file %s, error %s\n&quot;</span>,</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                   <a class="code" href="main_8cpp.html#a99867921a079d50ae18d40a21e6bcf73">logFileName</a>.c_str(), strerror(errno));</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        }</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    }</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <a class="code" href="main_8cpp.html#a436ee5100c9f7c541dc8648cf2afec59">logFile</a>=std::ofstream(<a class="code" href="main_8cpp.html#a99867921a079d50ae18d40a21e6bcf73">logFileName</a>);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <a class="code" href="main_8cpp.html#a436ee5100c9f7c541dc8648cf2afec59">logFile</a>&lt;&lt;<span class="stringliteral">&quot;Start&quot;</span>&lt;&lt;std::endl;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="main_8cpp.html#a436ee5100c9f7c541dc8648cf2afec59">logFile</a>) {                                                                     </div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            syslog(LOG_ERR, <span class="stringliteral">&quot;Can not open log file: %s, error: %s \n Exiting&quot;</span>,</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                   <a class="code" href="main_8cpp.html#a99867921a079d50ae18d40a21e6bcf73">logFileName</a>.c_str(), strerror(errno));</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;            <span class="keywordflow">return</span> EXIT_FAILURE;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160; </div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        }</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        signal(SIGSEGV,<a class="code" href="main_8cpp.html#a3b33e6f48f5d988f336e915c5346eb95">intHandler</a>);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        <span class="keywordflow">while</span> (1) {                                                                         </div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            <a class="code" href="main_8cpp.html#a436ee5100c9f7c541dc8648cf2afec59">logFile</a>&lt;&lt;<span class="stringliteral">&quot;Waiting for connection&quot;</span>&lt;&lt;std::endl;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;            <a class="code" href="main_8cpp.html#a2705b3e3588486b097f1cdd1ac8a4915">server_port</a> = std::shared_ptr&lt;server&gt;(<span class="keyword">new</span> <a class="code" href="classserver.html">server</a>(<span class="stringliteral">&quot;192.168.151.1&quot;</span>,1500));        </div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;            <a class="code" href="main_8cpp.html#a436ee5100c9f7c541dc8648cf2afec59">logFile</a>&lt;&lt;<span class="stringliteral">&quot;Server waiting&quot;</span>&lt;&lt;std::endl;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;            <a class="code" href="main_8cpp.html#a2705b3e3588486b097f1cdd1ac8a4915">server_port</a>-&gt;conn_server();                                                     </div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;            <a class="code" href="main_8cpp.html#a436ee5100c9f7c541dc8648cf2afec59">logFile</a>&lt;&lt;<span class="stringliteral">&quot;Connection created&quot;</span>&lt;&lt;std::endl;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            std::string message;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            <span class="keywordtype">int</span> runServer=1;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;            std::thread th;                                                                 </div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            <span class="keywordflow">while</span> (runServer)                                                               </div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            {</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                runServer=<a class="code" href="main_8cpp.html#a2705b3e3588486b097f1cdd1ac8a4915">server_port</a>-&gt;handler_msg();                                       </div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                message=<a class="code" href="main_8cpp.html#a2705b3e3588486b097f1cdd1ac8a4915">server_port</a>-&gt;get_msg();</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                <a class="code" href="main_8cpp.html#a436ee5100c9f7c541dc8648cf2afec59">logFile</a>&lt;&lt;message&lt;&lt;std::endl;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                <span class="keywordtype">float</span> velocity = -1;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                <span class="keywordtype">int</span> time=-1;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                <span class="keywordflow">if</span>(message.substr(0,5)==<span class="stringliteral">&quot;START&quot;</span>){                                           </div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                    std::vector&lt;std::string&gt; argss=<a class="code" href="classhelper.html#abd3f508d0e4be0840e8d79f6886f0e11">helper::split_str</a>(message);</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                    velocity= stof(argss.at(1));</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                    time = stoi(argss.at(2));</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                }</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160; </div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                <span class="keywordflow">if</span>((message.substr(0,5)==<span class="stringliteral">&quot;START&quot;</span> &amp;&amp; time&gt;0 &amp;&amp; velocity&gt;0)&amp;&amp; <a class="code" href="main_8cpp.html#a1c22f45bce9e423288fca0956719ce94">semaphor</a>!=<span class="stringliteral">&quot;RUN&quot;</span>)</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                {</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                    <a class="code" href="main_8cpp.html#aa73e018b04368e7afaded77ef0ac69db">m</a>.lock();</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                    <a class="code" href="main_8cpp.html#a1c22f45bce9e423288fca0956719ce94">semaphor</a>=<span class="stringliteral">&quot;START&quot;</span>;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                    <a class="code" href="main_8cpp.html#aa73e018b04368e7afaded77ef0ac69db">m</a>.unlock();</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                    th = std::thread(<a class="code" href="main_8cpp.html#adf98873ad83fffa5da0b4773a669d4ad">spin</a>,velocity,time);</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                }</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(message.substr(0,5)==<span class="stringliteral">&quot;START&quot;</span> &amp;&amp; <a class="code" href="main_8cpp.html#a1c22f45bce9e423288fca0956719ce94">semaphor</a> == <span class="stringliteral">&quot;RUN&quot;</span>){                 </div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                    <a class="code" href="main_8cpp.html#a2705b3e3588486b097f1cdd1ac8a4915">server_port</a>-&gt;send_msg(<span class="stringliteral">&quot;THREAD ALREADY RUNNING&quot;</span>);</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160; </div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                }</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                <span class="keywordflow">if</span>(message.substr(0,4)==<span class="stringliteral">&quot;STOP&quot;</span>)                                             </div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                {</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                    <a class="code" href="main_8cpp.html#aa73e018b04368e7afaded77ef0ac69db">m</a>.lock();</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                    <a class="code" href="main_8cpp.html#a1c22f45bce9e423288fca0956719ce94">semaphor</a>=<span class="stringliteral">&quot;STOP&quot;</span>;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                    <a class="code" href="main_8cpp.html#aa73e018b04368e7afaded77ef0ac69db">m</a>.unlock();</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                    <a class="code" href="main_8cpp.html#a2705b3e3588486b097f1cdd1ac8a4915">server_port</a>-&gt;send_msg(<span class="stringliteral">&quot;STOPING&quot;</span>);</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                }</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                <span class="keywordflow">if</span>(message.substr(0,4)==<span class="stringliteral">&quot;QUIT&quot;</span>)                                             </div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                {</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                    <a class="code" href="main_8cpp.html#aa73e018b04368e7afaded77ef0ac69db">m</a>.lock();</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                    <a class="code" href="main_8cpp.html#a1c22f45bce9e423288fca0956719ce94">semaphor</a>=<span class="stringliteral">&quot;STOP&quot;</span>;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                    <a class="code" href="main_8cpp.html#aa73e018b04368e7afaded77ef0ac69db">m</a>.unlock();</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                }</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="main_8cpp.html#a1c22f45bce9e423288fca0956719ce94">semaphor</a>==<span class="stringliteral">&quot;END&quot;</span>||<a class="code" href="main_8cpp.html#a1c22f45bce9e423288fca0956719ce94">semaphor</a>==<span class="stringliteral">&quot;STOP&quot;</span>){                                      </div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                    <span class="keywordflow">if</span>(th.joinable()){</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                        th.join();</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160; </div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                    }</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                }</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;            }</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160; </div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            <a class="code" href="main_8cpp.html#a436ee5100c9f7c541dc8648cf2afec59">logFile</a>&lt;&lt;<span class="stringliteral">&quot;Closing Connection&quot;</span>&lt;&lt;std::endl;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;            <a class="code" href="main_8cpp.html#a2705b3e3588486b097f1cdd1ac8a4915">server_port</a>-&gt;dconn_server();</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        }</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    }  <span class="keywordflow">catch</span> (std::exception&amp; e) {</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        <a class="code" href="main_8cpp.html#a436ee5100c9f7c541dc8648cf2afec59">logFile</a>&lt;&lt; <span class="stringliteral">&quot;Exception caught : &quot;</span> &lt;&lt; e.what() &lt;&lt; std::endl;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        <a class="code" href="main_8cpp.html#a2705b3e3588486b097f1cdd1ac8a4915">server_port</a>-&gt;dconn_server();</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    }</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160; </div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160; </div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160; </div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="keywordflow">return</span> EXIT_SUCCESS;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;};</div>
<div class="ttc" id="aclasshelper_html_a32bf313f928a848166485d6849b60e9a"><div class="ttname"><a href="classhelper.html#a32bf313f928a848166485d6849b60e9a">helper::cfg_syslog</a></div><div class="ttdeci">static void cfg_syslog()</div><div class="ttdoc">helper::cfg_syslog</div><div class="ttdef"><b>Definition:</b> <a href="helper_8cpp_source.html#l00190">helper.cpp:190</a></div></div>
<div class="ttc" id="aclasshelper_html_abd3f508d0e4be0840e8d79f6886f0e11"><div class="ttname"><a href="classhelper.html#abd3f508d0e4be0840e8d79f6886f0e11">helper::split_str</a></div><div class="ttdeci">static std::vector&lt; std::string &gt; split_str(std::string str)</div><div class="ttdoc">helper::split_str</div><div class="ttdef"><b>Definition:</b> <a href="helper_8cpp_source.html#l00083">helper.cpp:83</a></div></div>
<div class="ttc" id="aclasshelper_html_ad6664f31cf67b68d207479b4f930bd63"><div class="ttname"><a href="classhelper.html#ad6664f31cf67b68d207479b4f930bd63">helper::check_file</a></div><div class="ttdeci">static bool check_file(const std::string &amp;name)</div><div class="ttdoc">helper::check_file</div><div class="ttdef"><b>Definition:</b> <a href="helper_8cpp_source.html#l00070">helper.cpp:70</a></div></div>
<div class="ttc" id="aclassserver_html"><div class="ttname"><a href="classserver.html">server</a></div><div class="ttdoc">The server class.</div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00015">server.h:16</a></div></div>
<div class="ttc" id="amain_8cpp_html_a1c22f45bce9e423288fca0956719ce94"><div class="ttname"><a href="main_8cpp.html#a1c22f45bce9e423288fca0956719ce94">semaphor</a></div><div class="ttdeci">std::string semaphor</div><div class="ttdef"><b>Definition:</b> <a href="main_8cpp_source.html#l00042">main.cpp:42</a></div></div>
<div class="ttc" id="amain_8cpp_html_a3b33e6f48f5d988f336e915c5346eb95"><div class="ttname"><a href="main_8cpp.html#a3b33e6f48f5d988f336e915c5346eb95">intHandler</a></div><div class="ttdeci">void intHandler(int dummy)</div><div class="ttdoc">intHandler</div><div class="ttdef"><b>Definition:</b> <a href="main_8cpp_source.html#l00048">main.cpp:48</a></div></div>
<div class="ttc" id="amain_8cpp_html_a99867921a079d50ae18d40a21e6bcf73"><div class="ttname"><a href="main_8cpp.html#a99867921a079d50ae18d40a21e6bcf73">logFileName</a></div><div class="ttdeci">std::string logFileName</div><div class="ttdef"><b>Definition:</b> <a href="main_8cpp_source.html#l00038">main.cpp:38</a></div></div>
<div class="ttc" id="amain_8cpp_html_aa73e018b04368e7afaded77ef0ac69db"><div class="ttname"><a href="main_8cpp.html#aa73e018b04368e7afaded77ef0ac69db">m</a></div><div class="ttdeci">std::mutex m</div><div class="ttdef"><b>Definition:</b> <a href="main_8cpp_source.html#l00040">main.cpp:40</a></div></div>
<div class="ttc" id="amain_8cpp_html_adf98873ad83fffa5da0b4773a669d4ad"><div class="ttname"><a href="main_8cpp.html#adf98873ad83fffa5da0b4773a669d4ad">spin</a></div><div class="ttdeci">void spin(float vel, int time)</div><div class="ttdoc">spin</div><div class="ttdef"><b>Definition:</b> <a href="main_8cpp_source.html#l00062">main.cpp:62</a></div></div>
<div class="ttc" id="amain_8cpp_html_ae22136461a8511c472f1f662bd8f8fc3"><div class="ttname"><a href="main_8cpp.html#ae22136461a8511c472f1f662bd8f8fc3">logFilePath</a></div><div class="ttdeci">std::string logFilePath</div><div class="ttdef"><b>Definition:</b> <a href="main_8cpp_source.html#l00037">main.cpp:37</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adf98873ad83fffa5da0b4773a669d4ad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adf98873ad83fffa5da0b4773a669d4ad">&#9670;&nbsp;</a></span>spin()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void spin </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>vel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>time</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>spin </p>
<p>Spin function does data logging from ODrive, starting and stopping testbench and desired velocity for desired time. At first, function finds base position by homing. Then homing position is logged. Then function sets AXIS_STATE_CLOSED_LOOP_CONTROL and velocity passed as parameter. After that testbench starts spinning. Every 100 milliseconds are position data logged. After time passes, Velocity is set to 0 and position data are logging until actual velocity is close to 0. Then function sets AXIS_STATE_IDLE, so no force is affecting motor. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">vel</td><td>Velocity in rotation per second on motor </td></tr>
    <tr><td class="paramname">time</td><td>Time motor forces testbench to spin </td></tr>
  </table>
  </dd>
</dl>
<p>Homing testbench</p>
<p>Set AXIS_STATE_CLOSED_LOOP_CONTROL to prepare for spinning</p>
<p>Observing starting position and current data</p>
<p>Write to log file homing position data and then velocity</p>
<p>If semaphorn is changed to STOP or END sign, exit this loop</p>
<p>Every 100 milliseconds capture data from ODrive</p>
<p>If time parameter in seconds is reached, set velocity to zero and then stop after reaching actual zero velocity logging data</p>
<p>Set axis state to idle so no force affect testbench</p>

<p class="definition">Definition at line <a class="el" href="main_8cpp_source.html#l00062">62</a> of file <a class="el" href="main_8cpp_source.html">main.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                              {</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="keyword">const</span> std::string portName = <span class="stringliteral">&quot;/dev/oDrive&quot;</span>;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    std::unique_ptr&lt;oDrive&gt; odrive(<span class="keyword">new</span> <a class="code" href="classoDrive.html">oDrive</a>(portName));</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160; </div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    odrive-&gt;clear_errors(0);                                                                </div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    odrive-&gt;get_min_endstop(0);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    odrive-&gt;homing(0);</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160; </div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    odrive-&gt;get_min_endstop(0);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    odrive-&gt;clear_errors(0);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    odrive-&gt;set_min_endstop(0,<span class="keyword">false</span>);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160; </div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    odrive-&gt;get_min_endstop(0);</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    odrive-&gt;clear_errors(0);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    odrive-&gt;set_axis_state(0,odrive-&gt;AXIS_STATE_CLOSED_LOOP_CONTROL);                       </div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keywordtype">float</span> posCircular=odrive-&gt;get_pos_cir(0);                                               </div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="keywordtype">float</span> posEstimate=odrive-&gt;get_pos_est(0);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="keywordtype">float</span> posEstimateCounts = odrive-&gt;get_pos_est_cnt(0);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="keywordtype">float</span> posInTurns = odrive-&gt;get_pos_turns(0);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="keywordtype">float</span> IqMeasurd = odrive-&gt;get_curr_Iq(0);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160; </div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160; </div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160; </div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="keywordtype">float</span> velF=0.0;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    velF=vel;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="keyword">auto</span> start = std::chrono::steady_clock::now();</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160; </div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <a class="code" href="main_8cpp.html#a436ee5100c9f7c541dc8648cf2afec59">logFile</a>&lt;&lt;<a class="code" href="classlogger.html#a8964fcf3b5f4efa3220c9bfbcaea8174">logger::header</a>();</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160; </div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <a class="code" href="main_8cpp.html#a436ee5100c9f7c541dc8648cf2afec59">logFile</a>&lt;&lt;std::endl&lt;&lt;<a class="code" href="classlogger.html#a7456420e3d6af61db8899fa0eb2da659">logger::get_time</a>()&lt;&lt;std::endl;                                      </div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <a class="code" href="main_8cpp.html#a436ee5100c9f7c541dc8648cf2afec59">logFile</a>&lt;&lt;<span class="stringliteral">&quot;HOMING POSITION&quot;</span>&lt;&lt;std::endl&lt;&lt;<a class="code" href="classlogger.html#a9b76152893a20ce92f1383a00ee46449">logger::create_rec</a>(posCircular,posEstimate,posEstimateCounts,posInTurns,IqMeasurd)&lt;&lt;std::endl&lt;&lt;<span class="stringliteral">&quot;HOMING POSITION&quot;</span>&lt;&lt;std::endl;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160; </div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160; </div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <a class="code" href="main_8cpp.html#a436ee5100c9f7c541dc8648cf2afec59">logFile</a>&lt;&lt;<span class="stringliteral">&quot;Velocity = &quot;</span>&lt;&lt;std::to_string(velF)&lt;&lt;std::endl;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    odrive-&gt;set_vel(0,vel);</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="keyword">auto</span> timer = std::chrono::milliseconds(10);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160; </div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="keywordflow">while</span>(1)</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    {</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="main_8cpp.html#a1c22f45bce9e423288fca0956719ce94">semaphor</a>==<span class="stringliteral">&quot;END&quot;</span>||<a class="code" href="main_8cpp.html#a1c22f45bce9e423288fca0956719ce94">semaphor</a>==<span class="stringliteral">&quot;STOP&quot;</span>)                                               </div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        {</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;            <a class="code" href="main_8cpp.html#a436ee5100c9f7c541dc8648cf2afec59">logFile</a>&lt;&lt;<span class="stringliteral">&quot;Stopping&quot;</span>&lt;&lt;std::endl;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        }</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160; </div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        <span class="keywordflow">if</span>(std::chrono::steady_clock::now() - (start+timer) &gt; std::chrono::milliseconds(100))</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        {</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;            posCircular=odrive-&gt;get_pos_cir(0);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;            posEstimate=odrive-&gt;get_pos_est(0);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;            posEstimateCounts = odrive-&gt;get_pos_est_cnt(0);</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;            posInTurns = odrive-&gt;get_pos_turns(0);</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;            IqMeasurd= odrive-&gt;get_curr_Iq(0);</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;            std::string log=<a class="code" href="classlogger.html#a9b76152893a20ce92f1383a00ee46449">logger::create_rec</a>(posCircular,posEstimate,posEstimateCounts,posInTurns,IqMeasurd);</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;            <a class="code" href="main_8cpp.html#a2705b3e3588486b097f1cdd1ac8a4915">server_port</a>-&gt;send_msg(log);</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;            <a class="code" href="main_8cpp.html#a436ee5100c9f7c541dc8648cf2afec59">logFile</a>&lt;&lt;log&lt;&lt;std::endl;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        }</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <span class="keywordflow">if</span>(std::chrono::steady_clock::now()- start&gt; std::chrono::seconds(time))             </div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        {</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;            <span class="keywordtype">float</span> stopVel=odrive-&gt;get_vel(0);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;            <span class="keywordflow">if</span>(stopVel&lt;0.05||stopVel&gt;-0.05){</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                <a class="code" href="main_8cpp.html#aa73e018b04368e7afaded77ef0ac69db">m</a>.lock();</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                <a class="code" href="main_8cpp.html#a1c22f45bce9e423288fca0956719ce94">semaphor</a>=<span class="stringliteral">&quot;STOP&quot;</span>;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                <a class="code" href="main_8cpp.html#aa73e018b04368e7afaded77ef0ac69db">m</a>.unlock();</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                <a class="code" href="main_8cpp.html#a2705b3e3588486b097f1cdd1ac8a4915">server_port</a>-&gt;send_msg(<span class="stringliteral">&quot;FINISHED&quot;</span>);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;            }</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        }</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    }</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    odrive-&gt;set_axis_state(0,odrive-&gt;AXIS_STATE_IDLE);                                      </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;}</div>
<div class="ttc" id="aclasslogger_html_a7456420e3d6af61db8899fa0eb2da659"><div class="ttname"><a href="classlogger.html#a7456420e3d6af61db8899fa0eb2da659">logger::get_time</a></div><div class="ttdeci">static std::string get_time()</div><div class="ttdoc">logger::get_time</div><div class="ttdef"><b>Definition:</b> <a href="logger_8cpp_source.html#l00054">logger.cpp:54</a></div></div>
<div class="ttc" id="aclasslogger_html_a8964fcf3b5f4efa3220c9bfbcaea8174"><div class="ttname"><a href="classlogger.html#a8964fcf3b5f4efa3220c9bfbcaea8174">logger::header</a></div><div class="ttdeci">static std::string header()</div><div class="ttdoc">logger::header</div><div class="ttdef"><b>Definition:</b> <a href="logger_8cpp_source.html#l00042">logger.cpp:42</a></div></div>
<div class="ttc" id="aclasslogger_html_a9b76152893a20ce92f1383a00ee46449"><div class="ttname"><a href="classlogger.html#a9b76152893a20ce92f1383a00ee46449">logger::create_rec</a></div><div class="ttdeci">static std::string create_rec(float posCircular, float posEstimate, float posEstimateCounts, float posInTurns, float iqMeasured)</div><div class="ttdoc">logger::create_rec</div><div class="ttdef"><b>Definition:</b> <a href="logger_8cpp_source.html#l00090">logger.cpp:90</a></div></div>
<div class="ttc" id="aclassoDrive_html"><div class="ttname"><a href="classoDrive.html">oDrive</a></div><div class="ttdoc">The oDrive class.</div><div class="ttdef"><b>Definition:</b> <a href="oDrive_8h_source.html#l00018">oDrive.h:18</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a436ee5100c9f7c541dc8648cf2afec59"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a436ee5100c9f7c541dc8648cf2afec59">&#9670;&nbsp;</a></span>logFile</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::ofstream logFile</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Global variable for stream which is writing to log file </p>

<p class="definition">Definition at line <a class="el" href="main_8cpp_source.html#l00039">39</a> of file <a class="el" href="main_8cpp_source.html">main.cpp</a>.</p>

</div>
</div>
<a id="a99867921a079d50ae18d40a21e6bcf73"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a99867921a079d50ae18d40a21e6bcf73">&#9670;&nbsp;</a></span>logFileName</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::string logFileName = &quot;/var/log/tevogs/testbench.log&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Global variable for absolute path to log file </p>

<p class="definition">Definition at line <a class="el" href="main_8cpp_source.html#l00038">38</a> of file <a class="el" href="main_8cpp_source.html">main.cpp</a>.</p>

</div>
</div>
<a id="ae22136461a8511c472f1f662bd8f8fc3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae22136461a8511c472f1f662bd8f8fc3">&#9670;&nbsp;</a></span>logFilePath</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::string logFilePath =&quot;/var/log/tevogs/&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Global variable for path where log file is placed </p>

<p class="definition">Definition at line <a class="el" href="main_8cpp_source.html#l00037">37</a> of file <a class="el" href="main_8cpp_source.html">main.cpp</a>.</p>

</div>
</div>
<a id="aa73e018b04368e7afaded77ef0ac69db"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa73e018b04368e7afaded77ef0ac69db">&#9670;&nbsp;</a></span>m</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::mutex m</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Global variable for mutex for prevent data ovewrite by threads </p>

<p class="definition">Definition at line <a class="el" href="main_8cpp_source.html#l00040">40</a> of file <a class="el" href="main_8cpp_source.html">main.cpp</a>.</p>

</div>
</div>
<a id="a1c22f45bce9e423288fca0956719ce94"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1c22f45bce9e423288fca0956719ce94">&#9670;&nbsp;</a></span>semaphor</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::string semaphor</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Global variable for string representin semaphor to run or stop testbench </p>

<p class="definition">Definition at line <a class="el" href="main_8cpp_source.html#l00042">42</a> of file <a class="el" href="main_8cpp_source.html">main.cpp</a>.</p>

</div>
</div>
<a id="a2705b3e3588486b097f1cdd1ac8a4915"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2705b3e3588486b097f1cdd1ac8a4915">&#9670;&nbsp;</a></span>server_port</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::shared_ptr&lt;<a class="el" href="classserver.html">server</a>&gt; server_port</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Global variable for Server class </p>

<p class="definition">Definition at line <a class="el" href="main_8cpp_source.html#l00036">36</a> of file <a class="el" href="main_8cpp_source.html">main.cpp</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
